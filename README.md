# eval-estree-expression [![NPM version](https://img.shields.io/npm/v/eval-estree-expression.svg?style=flat)](https://www.npmjs.com/package/eval-estree-expression) [![NPM monthly downloads](https://img.shields.io/npm/dm/eval-estree-expression.svg?style=flat)](https://npmjs.org/package/eval-estree-expression) [![NPM total downloads](https://img.shields.io/npm/dt/eval-estree-expression.svg?style=flat)](https://npmjs.org/package/eval-estree-expression)

> Safely evaluate JavaScript (estree) expressions, sync and async.

Please consider following this project's author, [Jon Schlinkert](https://github.com/jonschlinkert), and consider starring the project to show your :heart: and support.

- [Install](#install)
- [Usage](#usage)
  * [Usage with Babel](#usage-with-babel)
  * [Usage with Esprima](#usage-with-esprima)
  * [async usage](#async-usage)
  * [sync usage](#sync-usage)
- [Options](#options)
  * [booleanLogicalOperators](#booleanlogicaloperators)
  * [functions](#functions)
  * [generate](#generate)
  * [regexOperator](#regexoperator)
  * [strict](#strict)
  * [withMembers](#withmembers)
- [About](#about)

_(TOC generated by [verb](https://github.com/verbose/verb) using [markdown-toc](https://github.com/jonschlinkert/markdown-toc))_

## Install

Install with [npm](https://www.npmjs.com/) :

```sh
$ npm install --save eval-estree-expression
```

## Usage

Evaluates an [estree](https://github.com/estree/estree) expression from [@babel/parser][], [esprima](http://esprima.org), [acorn](https://github.com/acornjs/acorn), or any other library that parses and returns a valid `estree` expression.

```js
const { evaluate } = require('eval-estree-expression');

evaluate(expressionTree[, context]); // async
evaluate.sync(expressionTree[, context]); // sync
```

See the [unit tests](./test) for hundreds of additional usage examples.

**Params**

The `evaluate` function takes the following arguments:

* `expressionTree` **{object}** - a valid [estree](https://github.com/estree/estree) expression AST.
* `context` **{object}** - a data object with values to replace variables in expressions

### Usage with Babel

Most of the examples in this document assume the following setup code is used:

```js
const { evaluate } = require('eval-estree-expression');
const { parseExpression } = require('@babel/parser');

// parse your JavaScript expression
const ast = parseExpression('1 + 2);

// evaluate synchronously
console.log(evaluate.sync(ast)); //=> 3

// or asynchronously
console.log(await evaluate(ast)); //=> 3
```

### Usage with Esprima

[Esprima][esprimar] doesn't have a "parseExpression" method like @babel/parser, so you'll need to return the expression from the AST, like so:

```js
const { parse } = require('esprima');
const { evaluate } = require('eval-estree-expression');
const ast = parse('[1, 2, 3].map(n => n * x);').body[0].expression;

// evaluate synchronously
console.log(evaluate.sync(ast)); // =>, [2, 4, 6]

// or asynchronously
console.log(await evaluate(ast)); // =>, [2, 4, 6]
```

### async usage

Evaluate expresssions asynchronously.

```js
console.log(await evaluate(parse('1 + 2'))); //=> 3
console.log(await evaluate(parse('5 * 2'))); //=> 10
console.log(await evaluate(parse('1 > 2'))); //=> false
console.log(await evaluate(parse('1 < 2'))); //=> true

// with context object
console.log(await evaluate(parse('page.title === "home"'), { page: { title: 'home' } })); //=> true
```

### sync usage

Evaluate expresssions synchronously.

```js
console.log(evaluate.sync(parse('1 + 2'))); //=> 3
console.log(evaluate.sync(parse('5 * 2'))); //=> 10
console.log(evaluate.sync(parse('1 > 2'))); //=> false
console.log(evaluate.sync(parse('1 < 2'))); //=> true

// with context object
console.log(evaluate.sync(parse('page.title === "home"'), { page: { title: 'home' } })); //=> true
```

## Options

### booleanLogicalOperators

Type: `boolean`
Default: `undefined`

Force logical operators to return a boolean result.

```js
console.log(await evaluate(parse('a && b'), { a: undefined, b: true })); //=> undefined
console.log(await evaluate(parse('a && b'), { a: undefined, b: false })); //=> undefined
console.log(await evaluate(parse('a || b'), { a: false, b: null })); //=> null
console.log(await evaluate(parse('a || b'), { a: false, b: undefined })); //=> undefined

//
// With booleanLogicalOperators enabled
//

const options = {
  booleanLogicalOperators: true
};

console.log(await evaluate(parse('a || b'), { a: false, b: null }, options)); //=> false
console.log(await evaluate(parse('a && b'), { a: undefined, b: true }, options)); //=> false
console.log(await evaluate(parse('a && b'), { a: undefined, b: false }, options)); //=> false
console.log(await evaluate(parse('a || b'), { a: false, b: undefined }, options)); //=> false
```

### functions

Type: `boolean`
Default: `false`

Allow function calls to be evaluated. This is unsafe, please enable this option at your own risk. As an extra precaution, to evaluate functions you must also enable the [generate](#generate) option.

**Example**

See the [generate](#generate) docs for an example.

### generate

Type: `boolean`
Default: `undefined`

Pass the `.generate()` function from the [escodegen](http://github.com/estools/escodegen) library to enable function evalution. For functions to be evaluated you must also set the `functions` option to `true`.

**Example**

```js
const { parse } = require('esprima');
const { generate } = require('escodegen');
const { evaluate } = require('eval-estree-expression');

const options = {
  functions: true,
  generate
};

console.log(await evaluate(('[1, 2, 3].map(n => n * x);'), { x: 2 }, options))); // =>, [2, 4, 6]
```

### regexOperator

Type: `boolean`
Default: `true`

In expressions, if you wish to test a value using a regular expression, you have two options:

1. Enable function support so that you can use methods like `.test()` and `.match()`, or
2. Use this option, which enables support for a special syntax for matching against regular expressions, _without the need to enable support for evaluating functions_.

In other words, instead of having to do this:

```js
console.log(evaluate.sync(parse('/^ab+c$/ig.test("abbbbbc")'), {}, { functions: true }));
```

You can do this:

```js
console.log(evaluate.sync(parse('name =~ /^a.*c$/'), { name: 'abc' }));
console.log(evaluate.sync(parse('name =~ regex'), { name: 'abc', regex: /^a.*c$/ }));
```

### strict

Type: `boolean`
Default: `false`

Throw an error when variables are undefined.

### withMembers

Type: `boolean`
Default: `undefined`

## About

<details>
<summary><strong>Contributing</strong></summary>

Pull requests and stars are always welcome. For bugs and feature requests, [please create an issue](../../issues/new).

</details>

<details>
<summary><strong>Running Tests</strong></summary>

Running and reviewing unit tests is a great way to get familiarized with a library and its API. You can install dependencies and run tests with the following command:

```sh
$ npm install && npm test
```

</details>

<details>
<summary><strong>Building docs</strong></summary>

_(This project's readme.md is generated by [verb](https://github.com/verbose/verb-generate-readme), please don't edit the readme directly. Any changes to the readme must be made in the [.verb.md](.verb.md) readme template.)_

To generate the readme, run the following command:

```sh
$ npm install -g verbose/verb#dev verb-generate-readme && verb
```

</details>

### Related projects

You might also be interested in these projects:

### Author

**Jon Schlinkert**

* [GitHub Profile](https://github.com/jonschlinkert)
* [Twitter Profile](https://twitter.com/jonschlinkert)
* [LinkedIn Profile](https://linkedin.com/in/jonschlinkert)

### License

Copyright Â© 2021, [Jon Schlinkert](https://github.com/jonschlinkert).
Released under the [MIT License](LICENSE).

***

_This file was generated by [verb-generate-readme](https://github.com/verbose/verb-generate-readme), v0.8.0, on September 05, 2021._
